<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="2026 Personal Year Planner - Goal setting and value tracking">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="2026 Planner">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%232563eb' width='180' height='180'/><text x='50%' y='50%' font-size='80' fill='white' text-anchor='middle' dy='.3em' font-family='Arial' font-weight='bold'>26</text></svg>">
    <link rel="manifest" href="data:application/json,{%22name%22:%222026%20Year%20Planner%22,%22short_name%22:%222026%20Planner%22,%22description%22:%22Personal%20goal%20setting%20and%20value%20tracking%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%230f172a%22,%22theme_color%22:%22%232563eb%22,%22orientation%22:%22portrait-primary%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20192%20192'><rect%20fill='%232563eb'%20width='192'%20height='192'/><text%20x='50%25'%20y='50%25'%20font-size='100'%20fill='white'%20text-anchor='middle'%20dy='.3em'%20font-family='Arial'%20font-weight='bold'>26</text></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%22},{%22src%22:%22data:image/svg+xml,<svg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'><rect%20fill='%232563eb'%20width='512'%20height='512'/><text%20x='50%25'%20y='50%25'%20font-size='280'%20fill='white'%20text-anchor='middle'%20dy='.3em'%20font-family='Arial'%20font-weight='bold'>26</text></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22maskable%22}]}">
    <title>2026 Year Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Install Banner */
        .install-banner {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 15px;
            animation: slideDown 0.3s ease-out;
        }

        .install-banner.show {
            display: flex;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .install-banner p {
            flex: 1;
            font-size: 14px;
        }

        .install-banner button {
            background: white;
            color: #2563eb;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .install-banner button:hover {
            transform: scale(1.05);
        }

        .close-banner {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
            padding: 6px 12px !important;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #94a3b8;
            font-size: 16px;
        }

        /* Main grid */
        .planner-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Sections */
        .goals-section, .value-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.6s ease-out;
        }

        .goals-section { animation-delay: 0.1s; }
        .value-section { animation-delay: 0.2s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #60a5fa 0%, #3b82f6 100%);
            border-radius: 2px;
        }

        .goal-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .goal-input-group input, .value-input-group input, .month-input input {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(15, 23, 42, 0.95);
            box-shadow: 0 0 12px rgba(96, 165, 250, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .goals-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .goal-item {
            background: rgba(15, 23, 42, 0.6);
            border-left: 3px solid #60a5fa;
            border-radius: 6px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .goal-item:hover {
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.15);
        }

        .goal-item button {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.4);
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .goal-item button:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Limits Section */
        .limits-subsection {
            background: rgba(15, 23, 42, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 3px solid #60a5fa;
        }

        .limits-subsection h4 {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .limit-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .limit-input-group input {
            font-size: 13px;
            padding: 10px 12px;
        }

        .limit-input-group label {
            font-size: 11px;
            color: #64748b;
            margin-bottom: 4px;
            display: block;
        }

        /* Value Stats */
        .value-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            border-radius: 8px;
            padding: 16px;
            border-left: 3px solid;
            transition: all 0.3s ease;
        }

        .stat-card.green {
            background: rgba(34, 197, 94, 0.1);
            border-left-color: #22c55e;
        }

        .stat-card.yellow {
            background: rgba(234, 179, 8, 0.1);
            border-left-color: #eab308;
        }

        .stat-card.red {
            background: rgba(239, 68, 68, 0.1);
            border-left-color: #ef4444;
        }

        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .stat-value {
            font-family: 'Poppins', sans-serif;
            font-size: 28px;
            font-weight: 700;
        }

        .stat-card.green .stat-value { color: #22c55e; }
        .stat-card.yellow .stat-value { color: #eab308; }
        .stat-card.red .stat-value { color: #ef4444; }

        .stat-limit {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
        }

        /* Months Grid */
        .months-section {
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }

        .month-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 4px solid rgba(59, 130, 246, 0.5);
        }

        .month-card.good {
            border-left-color: #22c55e;
            background: rgba(34, 197, 94, 0.05);
        }

        .month-card.warning {
            border-left-color: #eab308;
            background: rgba(234, 179, 8, 0.05);
        }

        .month-card.exceeded {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .month-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .month-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(96, 165, 250, 0.15);
        }

        .month-card:hover::before {
            transform: scaleX(1);
        }

        .month-name {
            font-family: 'Poppins', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 15px;
        }

        .month-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .month-input {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .month-input label {
            font-size: 11px;
            color: #94a3b8;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .month-input input {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: #60a5fa;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .month-status {
            font-size: 10px;
            margin-top: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            text-align: center;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .month-status.good {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .month-status.warning {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
        }

        .month-status.exceeded {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 13px;
            border-top: 1px solid rgba(59, 130, 246, 0.1);
            margin-top: 40px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .footer button {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.4);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .footer button:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .online-status {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .online-status.online {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .online-status.offline {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .online-status.online .status-dot {
            background: #22c55e;
        }

        .online-status.offline .status-dot {
            background: #ef4444;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .planner-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 36px;
            }

            .months-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 12px;
                padding-top: max(12px, env(safe-area-inset-top));
            }

            .header h1 {
                font-size: 28px;
            }

            .months-grid {
                grid-template-columns: 1fr;
            }

            .limit-input-group {
                grid-template-columns: 1fr;
            }

            .value-stats {
                grid-template-columns: 1fr;
            }

            .footer {
                flex-direction: column;
            }

            .footer button, .online-status {
                width: 100%;
                justify-content: center;
            }
        }

        /* Dashboard Section */
        .dashboard-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .dashboard-card {
            background: linear-gradient(135deg,
                rgba(37, 99, 235, 0.1) 0%,
                rgba(30, 64, 175, 0.1) 100%);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(96, 165, 250, 0.15);
            border-color: #60a5fa;
        }

        .dashboard-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .dashboard-value {
            font-family: 'Poppins', sans-serif;
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .dashboard-label {
            font-size: 13px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Charts Section */
        .charts-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }

        .chart-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .chart-tab {
            padding: 10px 20px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .chart-tab:hover {
            border-color: #60a5fa;
            background: rgba(15, 23, 42, 0.8);
        }

        .chart-tab.active {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            border-color: #3b82f6;
        }

        .chart-container {
            position: relative;
            height: 400px;
            display: none;
        }

        .chart-container.active {
            display: block;
        }

        /* Enhanced Goals with Milestones */
        .goal-item {
            background: rgba(15, 23, 42, 0.6);
            border-left: 3px solid #60a5fa;
            border-radius: 6px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            flex-direction: column;
            align-items: stretch;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 4px 0;
            user-select: none;
        }

        .goal-header:hover .goal-title {
            color: #60a5fa;
        }

        .goal-progress-indicator {
            font-size: 11px;
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .goal-content {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(59, 130, 246, 0.2);
            display: none;
        }

        .goal-content.expanded {
            display: block;
        }

        .progress-bar-container {
            position: relative;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            height: 28px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
            transition: width 0.3s ease;
            min-width: 0%;
        }

        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 28px;
            font-size: 12px;
            font-weight: 600;
            color: #e2e8f0;
            z-index: 1;
        }

        .milestone-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .milestone-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .milestone-item:hover {
            background: rgba(15, 23, 42, 0.6);
        }

        .milestone-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .milestone-item span {
            flex: 1;
            font-size: 14px;
            word-break: break-word;
        }

        .milestone-item span.completed {
            text-decoration: line-through;
            color: #64748b;
        }

        .milestone-item button {
            background: none;
            border: none;
            color: #ef4444;
            font-size: 22px;
            cursor: pointer;
            padding: 0 6px;
            line-height: 1;
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }

        .milestone-item button:hover {
            transform: scale(1.2);
        }

        .add-milestone {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .add-milestone input {
            flex: 1;
            font-size: 13px;
            padding: 10px 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
        }

        .add-milestone input:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(15, 23, 42, 0.95);
            box-shadow: 0 0 12px rgba(96, 165, 250, 0.2);
        }

        .add-milestone button {
            padding: 10px 18px;
            font-size: 13px;
        }

        .btn-delete {
            width: 100%;
            padding: 10px;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-1px);
        }

        /* Category Tabs for Value Tracking */
        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 16px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-tab:hover {
            border-color: #60a5fa;
            background: rgba(15, 23, 42, 0.8);
        }

        .category-tab.active {
            color: white;
            font-weight: 600;
        }

        .category-tab.active.monetary {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            border-color: #3b82f6;
        }

        .category-tab.active.certifications {
            background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%);
            border-color: #a855f7;
        }

        .category-tab.active.skills {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            border-color: #22c55e;
        }

        .category-tab.active.memberships {
            background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
            border-color: #f97316;
        }

        .category-content {
            display: none;
        }

        .category-content.active {
            display: block;
        }

        /* Category Color Variants */
        .stat-card.monetary {
            border-left-color: #3b82f6;
        }

        .stat-card.certifications {
            border-left-color: #a855f7;
        }

        .stat-card.skills {
            border-left-color: #22c55e;
        }

        .stat-card.memberships {
            border-left-color: #f97316;
        }

        .stat-card.overall {
            border-left-color: #facc15;
        }

        /* Export/Import Section */
        .export-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        .export-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-export, .btn-import {
            flex: 0 0 auto;
            cursor: pointer;
        }

        .backup-info {
            flex: 1;
            text-align: right;
            font-size: 13px;
            color: #94a3b8;
            font-style: italic;
        }

        /* Mobile Responsive Updates */
        @media (max-width: 640px) {
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }

            .dashboard-card {
                padding: 18px;
            }

            .dashboard-icon {
                font-size: 24px;
            }

            .dashboard-value {
                font-size: 24px;
            }

            .dashboard-label {
                font-size: 11px;
            }

            .chart-container {
                height: 300px;
            }

            .chart-tabs {
                gap: 8px;
            }

            .chart-tab {
                padding: 8px 14px;
                font-size: 12px;
            }

            .export-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .backup-info {
                text-align: center;
            }

            .btn-export, .btn-import {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Install Banner -->
        <div class="install-banner" id="installBanner">
            <p>üì± Install this app on your device for quick access and offline use</p>
            <button onclick="promptInstall()">Install</button>
            <button class="close-banner" onclick="closeBanner()">‚úï</button>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>2026 Year Planner</h1>
            <p>Set your goals and track value delivered throughout the year <button onclick="document.getElementById('infoModal').style.display='flex'" style="background: none; border: none; color: #60a5fa; cursor: pointer; font-size: 16px; margin-left: 10px;">‚ùì</button></p>
        </div>

        <!-- Dashboard Section -->
        <div class="dashboard-section">
            <div class="section-title">Year Overview</div>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="dashboard-icon">üéØ</div>
                    <div class="dashboard-value" id="goalCompletionRate">0%</div>
                    <div class="dashboard-label">Goals Completed</div>
                </div>
                <div class="dashboard-card monetary">
                    <div class="dashboard-icon">üí∞</div>
                    <div class="dashboard-value" id="ytdMonetary">$0</div>
                    <div class="dashboard-label">Total Monetary</div>
                </div>
                <div class="dashboard-card certifications">
                    <div class="dashboard-icon">üéì</div>
                    <div class="dashboard-value" id="ytdCertifications">0</div>
                    <div class="dashboard-label">Total Certifications</div>
                </div>
                <div class="dashboard-card skills">
                    <div class="dashboard-icon">‚ö°</div>
                    <div class="dashboard-value" id="ytdSkills">0</div>
                    <div class="dashboard-label">Total Skills</div>
                </div>
                <div class="dashboard-card memberships">
                    <div class="dashboard-icon">ü§ù</div>
                    <div class="dashboard-value" id="ytdMemberships">0</div>
                    <div class="dashboard-label">Total Memberships</div>
                </div>
                <div class="dashboard-card monetary">
                    <div class="dashboard-icon">üìä</div>
                    <div class="dashboard-value" id="avgMonetary">$0</div>
                    <div class="dashboard-label">Avg Monthly ($)</div>
                </div>
                <div class="dashboard-card overall">
                    <div class="dashboard-icon">‚≠ê</div>
                    <div class="dashboard-value" id="bestCategory">-</div>
                    <div class="dashboard-label">Top Category</div>
                </div>
                <div class="dashboard-card overall">
                    <div class="dashboard-icon">üöÄ</div>
                    <div class="dashboard-value" id="overallProgress">0%</div>
                    <div class="dashboard-label">Overall Progress</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="section-title">Analytics</div>
            <div class="chart-tabs">
                <div class="chart-tab active" onclick="switchChartTab('trend')">Monthly Trends</div>
                <div class="chart-tab" onclick="switchChartTab('overview')">Year Overview</div>
                <div class="chart-tab" onclick="switchChartTab('goals')">Goals Progress</div>
            </div>
            <div class="chart-container active" id="chart-trend">
                <canvas id="monthlyTrendChart"></canvas>
            </div>
            <div class="chart-container" id="chart-overview">
                <canvas id="yearOverviewChart"></canvas>
            </div>
            <div class="chart-container" id="chart-goals">
                <canvas id="goalsProgressChart"></canvas>
            </div>
        </div>

        <!-- Main Planning Grid -->
        <div class="planner-grid">
            <!-- Goals Section -->
            <div class="goals-section">
                <div class="section-title">Annual Goals</div>
                <div class="goal-input-group">
                    <input type="text" id="goalInput" placeholder="Add a new goal..." />
                    <button class="btn" onclick="addGoal()">Add</button>
                </div>
                <div class="goals-list" id="goalsList"></div>
            </div>

            <!-- Value Tracking Section -->
            <div class="value-section">
                <div class="section-title">Value Delivered</div>

                <!-- Category Tabs -->
                <div class="category-tabs">
                    <div class="category-tab active monetary" onclick="switchCategory('monetary')">
                        <span>üí∞</span> Monetary
                    </div>
                    <div class="category-tab certifications" onclick="switchCategory('certifications')">
                        <span>üéì</span> Certifications
                    </div>
                    <div class="category-tab skills" onclick="switchCategory('skills')">
                        <span>‚ö°</span> Skills
                    </div>
                    <div class="category-tab memberships" onclick="switchCategory('memberships')">
                        <span>ü§ù</span> Memberships
                    </div>
                </div>

                <!-- Category Content Containers -->
                <div class="category-content active" id="content-monetary">
                    <!-- Monthly Limits -->
                    <div class="limits-subsection">
                        <h4>üìà Monthly Target</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Limit ($)</label>
                                <input type="number" id="monthlyLimit-monetary" placeholder="0" onchange="saveCategoryLimit('monetary')" />
                            </div>
                            <div>
                                <label>Warning at %</label>
                                <input type="number" id="monthlyWarning-monetary" value="80" min="0" max="100" onchange="saveCategoryLimit('monetary')" />
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Input -->
                    <div class="limits-subsection">
                        <h4>Add Monthly Value</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Month (1-12)</label>
                                <input type="number" id="monthNum-monetary" min="1" max="12" placeholder="1-12" />
                            </div>
                            <div>
                                <label>Value ($)</label>
                                <input type="number" id="monthValue-monetary" placeholder="Amount" />
                            </div>
                        </div>
                        <button class="btn" onclick="addCategoryValue('monetary')" style="width: 100%;">Add Value</button>
                    </div>
                </div>

                <div class="category-content" id="content-certifications">
                    <!-- Monthly Limits -->
                    <div class="limits-subsection">
                        <h4>üìà Monthly Target</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Limit (Count)</label>
                                <input type="number" id="monthlyLimit-certifications" placeholder="0" onchange="saveCategoryLimit('certifications')" />
                            </div>
                            <div>
                                <label>Warning at %</label>
                                <input type="number" id="monthlyWarning-certifications" value="80" min="0" max="100" onchange="saveCategoryLimit('certifications')" />
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Input -->
                    <div class="limits-subsection">
                        <h4>Add Monthly Certifications</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Month (1-12)</label>
                                <input type="number" id="monthNum-certifications" min="1" max="12" placeholder="1-12" />
                            </div>
                            <div>
                                <label>Count</label>
                                <input type="number" id="monthValue-certifications" placeholder="Number earned" />
                            </div>
                        </div>
                        <button class="btn" onclick="addCategoryValue('certifications')" style="width: 100%;">Add Certifications</button>
                    </div>
                </div>

                <div class="category-content" id="content-skills">
                    <!-- Monthly Limits -->
                    <div class="limits-subsection">
                        <h4>üìà Monthly Target</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Limit (Count)</label>
                                <input type="number" id="monthlyLimit-skills" placeholder="0" onchange="saveCategoryLimit('skills')" />
                            </div>
                            <div>
                                <label>Warning at %</label>
                                <input type="number" id="monthlyWarning-skills" value="80" min="0" max="100" onchange="saveCategoryLimit('skills')" />
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Input -->
                    <div class="limits-subsection">
                        <h4>Add Monthly Skills</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Month (1-12)</label>
                                <input type="number" id="monthNum-skills" min="1" max="12" placeholder="1-12" />
                            </div>
                            <div>
                                <label>Count</label>
                                <input type="number" id="monthValue-skills" placeholder="Skills learned" />
                            </div>
                        </div>
                        <button class="btn" onclick="addCategoryValue('skills')" style="width: 100%;">Add Skills</button>
                    </div>
                </div>

                <div class="category-content" id="content-memberships">
                    <!-- Monthly Limits -->
                    <div class="limits-subsection">
                        <h4>üìà Monthly Target</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Limit (Count)</label>
                                <input type="number" id="monthlyLimit-memberships" placeholder="0" onchange="saveCategoryLimit('memberships')" />
                            </div>
                            <div>
                                <label>Warning at %</label>
                                <input type="number" id="monthlyWarning-memberships" value="80" min="0" max="100" onchange="saveCategoryLimit('memberships')" />
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Input -->
                    <div class="limits-subsection">
                        <h4>Add Monthly Memberships</h4>
                        <div class="limit-input-group">
                            <div>
                                <label>Month (1-12)</label>
                                <input type="number" id="monthNum-memberships" min="1" max="12" placeholder="1-12" />
                            </div>
                            <div>
                                <label>Count</label>
                                <input type="number" id="monthValue-memberships" placeholder="Orgs joined" />
                            </div>
                        </div>
                        <button class="btn" onclick="addCategoryValue('memberships')" style="width: 100%;">Add Memberships</button>
                    </div>
                </div>

                <button class="btn" onclick="clearCategoryData()" style="width: 100%; margin-top: 15px;">Clear Current Category</button>
            </div>
        </div>

        <!-- Months Section -->
        <div class="months-section">
            <div class="section-title" style="margin-bottom: 25px;">Monthly Tracking</div>
            <div class="months-grid" id="monthsGrid"></div>
        </div>

        <!-- Export/Import Section -->
        <div class="export-section">
            <div class="section-title">Backup & Restore</div>
            <div class="export-controls">
                <button class="btn btn-export" onclick="exportData()">üì• Download Backup</button>
                <label for="importFile" class="btn btn-import">üì§ Import Backup</label>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                <div class="backup-info" id="backupInfo">Last backup: Never</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="online-status" id="onlineStatus">
                <div class="status-dot"></div>
                <span>Online</span>
            </div>
            <p title="Data is stored locally in your browser using localStorage - completely private and secure">üíæ Auto-saving locally</p>
            <button onclick="if(confirm('Clear all data? This cannot be undone.')) { clearAllData(); }">Clear All Data</button>
        </div>

        <!-- Info Modal -->
        <div id="infoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 20px;">
            <div style="background: #1e293b; border-radius: 12px; padding: 30px; max-width: 500px; color: #e2e8f0; border: 1px solid rgba(59, 130, 246, 0.3);">
                <h2 style="color: #60a5fa; margin-bottom: 16px;">How Data is Saved</h2>
                <p style="margin-bottom: 12px; line-height: 1.6;"><strong>üì± Local Storage:</strong> Your data is saved directly on your device/browser using "localStorage" - this is like a secure filing cabinet built into your browser.</p>
                <p style="margin-bottom: 12px; line-height: 1.6;"><strong>üîí Private & Secure:</strong> No one can access your data. It's not sent to any server. Only you can see it.</p>
                <p style="margin-bottom: 12px; line-height: 1.6;"><strong>üíæ Automatic Saving:</strong> Every time you add a goal, value, or change a number, it saves instantly. No manual "Save" button needed.</p>
                <p style="margin-bottom: 12px; line-height: 1.6;"><strong>üåê Offline Access:</strong> The app works perfectly offline. You can add data, view everything, and it syncs when online.</p>
                <p style="margin-bottom: 12px; line-height: 1.6;"><strong>üì≤ On Your Device:</strong> When installed as an app (iOS/Android), data stays on your phone and doesn't sync to cloud unless you manually export.</p>
                <p style="margin-bottom: 20px; line-height: 1.6; color: #94a3b8;"><strong>‚ö†Ô∏è Important:</strong> If you clear your browser data or uninstall the app without backing up, your data will be lost.</p>
                <button onclick="document.getElementById('infoModal').style.display='none'" style="background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%;">Got it</button>
            </div>
        </div>
    </div>

    <script>
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        const categories = ['monetary', 'certifications', 'skills', 'memberships'];
        const categoryLabels = {
            monetary: { name: 'Monetary', icon: 'üí∞', unit: '$' },
            certifications: { name: 'Certifications', icon: 'üéì', unit: '' },
            skills: { name: 'Skills', icon: '‚ö°', unit: '' },
            memberships: { name: 'Memberships', icon: 'ü§ù', unit: '' }
        };
        let currentCategory = 'monetary';
        let deferredPrompt;
        let monthlyTrendChart, yearOverviewChart, goalsProgressChart;

        // Data Migration
        function migrateGoalsToV2() {
            const oldGoals = JSON.parse(localStorage.getItem('goals')) || [];
            const existingV2 = localStorage.getItem('goalsV2');

            // If V2 already exists, don't migrate again
            if (existingV2) return;

            // Convert old format to new format
            const newGoals = oldGoals.map((goalText, index) => ({
                id: `goal_${Date.now() + index}`,
                title: goalText,
                milestones: [],
                createdAt: Date.now() + index,
                completedAt: null
            }));

            localStorage.setItem('goalsV2', JSON.stringify(newGoals));
        }

        function migrateCategories() {
            // Check if already migrated
            const migrated = localStorage.getItem('categoriesMigrated');
            if (migrated) return;

            // Migrate old monthlyValues to monetary category
            const oldMonthlyValues = localStorage.getItem('monthlyValues');
            if (oldMonthlyValues) {
                localStorage.setItem('monthlyValues-monetary', oldMonthlyValues);
            }

            // Migrate old weeklyValues to monetary category
            const oldWeeklyValues = localStorage.getItem('weeklyValues');
            if (oldWeeklyValues) {
                localStorage.setItem('weeklyValues-monetary', oldWeeklyValues);
            }

            // Migrate old limits
            const oldMonthlyLimit = localStorage.getItem('monthlyLimit');
            const oldMonthlyWarning = localStorage.getItem('monthlyWarning');
            if (oldMonthlyLimit) {
                localStorage.setItem('monthlyLimit-monetary', oldMonthlyLimit);
            }
            if (oldMonthlyWarning) {
                localStorage.setItem('monthlyWarning-monetary', oldMonthlyWarning);
            }

            // Mark as migrated
            localStorage.setItem('categoriesMigrated', 'true');
        }

        // Category Management
        function switchCategory(category) {
            currentCategory = category;

            // Update tab active states
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.category-tab.${category}`).classList.add('active');

            // Update content visibility
            document.querySelectorAll('.category-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`content-${category}`).classList.add('active');

            // Load limits for this category
            loadCategoryLimits(category);
        }

        function loadCategoryLimits(category) {
            const limit = localStorage.getItem(`monthlyLimit-${category}`) || '';
            const warning = localStorage.getItem(`monthlyWarning-${category}`) || '80';

            const limitInput = document.getElementById(`monthlyLimit-${category}`);
            const warningInput = document.getElementById(`monthlyWarning-${category}`);

            if (limitInput) limitInput.value = limit;
            if (warningInput) warningInput.value = warning;
        }

        function saveCategoryLimit(category) {
            const limit = parseFloat(document.getElementById(`monthlyLimit-${category}`).value) || 0;
            const warning = parseFloat(document.getElementById(`monthlyWarning-${category}`).value) || 80;

            localStorage.setItem(`monthlyLimit-${category}`, limit);
            localStorage.setItem(`monthlyWarning-${category}`, warning);

            updateDashboard();
            updateCharts();
        }

        function addCategoryValue(category) {
            const monthNum = parseInt(document.getElementById(`monthNum-${category}`).value);
            const value = parseFloat(document.getElementById(`monthValue-${category}`).value);

            if (isNaN(monthNum) || isNaN(value) || monthNum < 1 || monthNum > 12) {
                alert('Please enter valid month (1-12) and value');
                return;
            }

            let monthlyData = JSON.parse(localStorage.getItem(`monthlyValues-${category}`)) || {};
            monthlyData[`month_${monthNum}`] = value;
            localStorage.setItem(`monthlyValues-${category}`, JSON.stringify(monthlyData));

            document.getElementById(`monthNum-${category}`).value = '';
            document.getElementById(`monthValue-${category}`).value = '';

            updateDashboard();
            updateCharts();
            renderMonths();
        }

        function clearCategoryData() {
            if (!confirm(`Clear all ${categoryLabels[currentCategory].name} data?`)) return;

            localStorage.removeItem(`monthlyValues-${currentCategory}`);
            localStorage.removeItem(`weeklyValues-${currentCategory}`);

            document.getElementById(`monthNum-${currentCategory}`).value = '';
            document.getElementById(`monthValue-${currentCategory}`).value = '';

            updateDashboard();
            updateCharts();
            renderMonths();
        }

        // Dashboard Functions
        function updateDashboard() {
            // Goal Completion Rate
            const goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            const totalGoals = goals.length;
            let completedGoals = 0;

            goals.forEach(goal => {
                if (goal.milestones.length === 0) return;
                const allComplete = goal.milestones.every(m => m.completed);
                if (allComplete) completedGoals++;
            });

            const goalRate = totalGoals > 0 ? ((completedGoals / totalGoals) * 100).toFixed(0) : 0;
            document.getElementById('goalCompletionRate').textContent = `${goalRate}%`;

            // Category totals
            const categoryTotals = {};
            categories.forEach(category => {
                const monthlyData = JSON.parse(localStorage.getItem(`monthlyValues-${category}`)) || {};
                const ytd = Object.values(monthlyData).reduce((sum, val) => sum + val, 0);
                categoryTotals[category] = ytd;

                // Update category YTD cards
                const unit = categoryLabels[category].unit;
                document.getElementById(`ytd${category.charAt(0).toUpperCase() + category.slice(1)}`).textContent =
                    `${unit}${ytd.toFixed(category === 'monetary' ? 0 : 0)}`;
            });

            // Average Monthly (Monetary)
            const monetaryData = JSON.parse(localStorage.getItem('monthlyValues-monetary')) || {};
            const monthsWithData = Object.keys(monetaryData).length;
            const avg = monthsWithData > 0 ? categoryTotals.monetary / monthsWithData : 0;
            document.getElementById('avgMonetary').textContent = `$${avg.toFixed(0)}`;

            // Top Category (which category has most activity)
            let topCategory = '-';
            let maxCount = 0;
            categories.forEach(category => {
                const monthlyData = JSON.parse(localStorage.getItem(`monthlyValues-${category}`)) || {};
                const count = Object.keys(monthlyData).length;
                if (count > maxCount) {
                    maxCount = count;
                    topCategory = `${categoryLabels[category].icon} ${categoryLabels[category].name}`;
                }
            });
            document.getElementById('bestCategory').textContent = topCategory;

            // Overall Progress (combination of goals completion and category activity)
            const totalMonthsTracked = categories.reduce((sum, cat) => {
                const data = JSON.parse(localStorage.getItem(`monthlyValues-${cat}`)) || {};
                return sum + Object.keys(data).length;
            }, 0);
            const maxPossibleMonths = 12 * categories.length; // 12 months * 4 categories
            const activityRate = maxPossibleMonths > 0 ? ((totalMonthsTracked / maxPossibleMonths) * 100).toFixed(0) : 0;
            const overallProgress = ((parseInt(goalRate) + parseInt(activityRate)) / 2).toFixed(0);
            document.getElementById('overallProgress').textContent = `${overallProgress}%`;
        }

        // Export/Import Functions
        function exportData() {
            const categoryData = {};
            categories.forEach(category => {
                categoryData[category] = {
                    monthlyValues: JSON.parse(localStorage.getItem(`monthlyValues-${category}`)) || {},
                    weeklyValues: JSON.parse(localStorage.getItem(`weeklyValues-${category}`)) || {},
                    monthlyLimit: localStorage.getItem(`monthlyLimit-${category}`) || '',
                    monthlyWarning: localStorage.getItem(`monthlyWarning-${category}`) || '80'
                };
            });

            const data = {
                version: '3.0', // Updated version for multi-category support
                exportDate: new Date().toISOString(),
                goals: JSON.parse(localStorage.getItem('goalsV2')) || [],
                goalsLegacy: JSON.parse(localStorage.getItem('goals')) || [],
                categories: categoryData,
                metadata: {
                    totalGoals: (JSON.parse(localStorage.getItem('goalsV2')) || []).length,
                    totalMilestones: (JSON.parse(localStorage.getItem('goalsV2')) || [])
                        .reduce((sum, g) => sum + g.milestones.length, 0),
                    categoriesEnabled: categories.length
                }
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `year-planner-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Save last backup date
            localStorage.setItem('lastBackupDate', Date.now());
            updateBackupInfo();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    // Validate data structure
                    if (!data.version) {
                        throw new Error('Invalid backup file format');
                    }

                    // Confirm before overwriting
                    if (!confirm('This will replace all current data. Continue?')) {
                        event.target.value = '';
                        return;
                    }

                    // Import data
                    if (data.goals) {
                        localStorage.setItem('goalsV2', JSON.stringify(data.goals));
                    }
                    if (data.goalsLegacy) {
                        localStorage.setItem('goals', JSON.stringify(data.goalsLegacy));
                    }

                    // Import category data (v3.0+) or legacy data (v2.0)
                    if (data.categories) {
                        // New format with categories
                        categories.forEach(category => {
                            if (data.categories[category]) {
                                const catData = data.categories[category];
                                if (catData.monthlyValues) {
                                    localStorage.setItem(`monthlyValues-${category}`, JSON.stringify(catData.monthlyValues));
                                }
                                if (catData.weeklyValues) {
                                    localStorage.setItem(`weeklyValues-${category}`, JSON.stringify(catData.weeklyValues));
                                }
                                if (catData.monthlyLimit !== undefined) {
                                    localStorage.setItem(`monthlyLimit-${category}`, catData.monthlyLimit);
                                }
                                if (catData.monthlyWarning !== undefined) {
                                    localStorage.setItem(`monthlyWarning-${category}`, catData.monthlyWarning);
                                }
                            }
                        });
                    } else {
                        // Legacy format (v2.0) - import as monetary
                        if (data.weeklyValues) {
                            localStorage.setItem('weeklyValues-monetary', JSON.stringify(data.weeklyValues));
                        }
                        if (data.monthlyValues) {
                            localStorage.setItem('monthlyValues-monetary', JSON.stringify(data.monthlyValues));
                        }
                        if (data.limits) {
                            localStorage.setItem('monthlyLimit-monetary', data.limits.monthlyLimit);
                            localStorage.setItem('monthlyWarning-monetary', data.limits.monthlyWarning);
                        }
                    }

                    alert('Data imported successfully!');
                    location.reload();
                } catch (error) {
                    alert('Error importing backup: ' + error.message);
                    event.target.value = '';
                }
            };
            reader.readAsText(file);
        }

        function updateBackupInfo() {
            const lastBackup = localStorage.getItem('lastBackupDate');
            const info = document.getElementById('backupInfo');
            if (lastBackup) {
                const date = new Date(parseInt(lastBackup));
                info.textContent = `Last backup: ${date.toLocaleDateString()}`;
            } else {
                info.textContent = 'Last backup: Never';
            }
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').classList.add('show');
        });

        function promptInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    closeBanner();
                });
            }
        }

        function closeBanner() {
            document.getElementById('installBanner').classList.remove('show');
        }

        // Online/Offline Status
        function updateOnlineStatus() {
            const status = document.getElementById('onlineStatus');
            if (navigator.onLine) {
                status.classList.remove('offline');
                status.classList.add('online');
                status.innerHTML = '<div class="status-dot"></div><span>Online</span>';
            } else {
                status.classList.remove('online');
                status.classList.add('offline');
                status.innerHTML = '<div class="status-dot"></div><span>Offline</span>';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Service Worker Registration for Offline Support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);

                        // Check for updates periodically
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    console.log('New version available! Refresh to update.');
                                    // Optionally show a notification to the user
                                    if (confirm('A new version of Year Planner is available! Refresh now?')) {
                                        newWorker.postMessage({ action: 'skipWaiting' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });

                // Reload page when new service worker takes control
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (!refreshing) {
                        refreshing = true;
                        window.location.reload();
                    }
                });
            });
        }

        // Initialize planner
        function initPlanner() {
            migrateGoalsToV2();
            migrateCategories();
            renderMonths();
            loadGoals();
            loadCategoryLimits('monetary'); // Load initial category
            updateOnlineStatus();
            updateDashboard();
            updateBackupInfo();
            updateCharts();
        }

        // Goals Management
        function addGoal() {
            const input = document.getElementById('goalInput');
            const goalTitle = input.value.trim();
            if (!goalTitle) return;

            let goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            const newGoal = {
                id: `goal_${Date.now()}`,
                title: goalTitle,
                milestones: [],
                createdAt: Date.now(),
                completedAt: null
            };
            goals.push(newGoal);
            localStorage.setItem('goalsV2', JSON.stringify(goals));

            // Also update legacy format for backward compatibility
            let legacyGoals = JSON.parse(localStorage.getItem('goals')) || [];
            legacyGoals.push(goalTitle);
            localStorage.setItem('goals', JSON.stringify(legacyGoals));

            input.value = '';
            renderGoals();
            updateDashboard();
        }

        function loadGoals() {
            renderGoals();
        }

        function renderGoals() {
            const goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';

            goals.forEach((goal) => {
                const completedMilestones = goal.milestones.filter(m => m.completed).length;
                const totalMilestones = goal.milestones.length;
                const progress = totalMilestones > 0
                    ? (completedMilestones / totalMilestones * 100).toFixed(0)
                    : 0;

                const div = document.createElement('div');
                div.className = 'goal-item';
                div.innerHTML = `
                    <div class="goal-header" onclick="toggleGoal('${goal.id}')">
                        <span class="goal-title">${goal.title}</span>
                        <span class="goal-progress-indicator">
                            ${totalMilestones > 0 ? `${completedMilestones}/${totalMilestones}` : 'No milestones'}
                        </span>
                    </div>
                    <div class="goal-content" id="goal-${goal.id}">
                        ${totalMilestones > 0 ? `
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: ${progress}%"></div>
                                <span class="progress-text">${progress}% Complete</span>
                            </div>
                        ` : ''}
                        <div class="milestone-list">
                            ${goal.milestones.map(m => `
                                <div class="milestone-item">
                                    <input type="checkbox" ${m.completed ? 'checked' : ''}
                                        onchange="toggleMilestone('${goal.id}', '${m.id}')">
                                    <span class="${m.completed ? 'completed' : ''}">${m.text}</span>
                                    <button onclick="deleteMilestone('${goal.id}', '${m.id}')">√ó</button>
                                </div>
                            `).join('')}
                        </div>
                        <div class="add-milestone">
                            <input type="text" id="milestone-input-${goal.id}" placeholder="Add milestone...">
                            <button class="btn" onclick="addMilestone('${goal.id}')">Add</button>
                        </div>
                        <button class="btn-delete" onclick="deleteGoal('${goal.id}')">Delete Goal</button>
                    </div>
                `;
                goalsList.appendChild(div);
            });
        }

        function toggleGoal(goalId) {
            const content = document.getElementById(`goal-${goalId}`);
            content.classList.toggle('expanded');
        }

        function addMilestone(goalId) {
            const input = document.getElementById(`milestone-input-${goalId}`);
            const text = input.value.trim();
            if (!text) return;

            const goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;

            goal.milestones.push({
                id: `milestone_${Date.now()}`,
                text: text,
                completed: false,
                createdAt: Date.now()
            });

            localStorage.setItem('goalsV2', JSON.stringify(goals));
            input.value = '';
            renderGoals();
            updateDashboard();
        }

        function toggleMilestone(goalId, milestoneId) {
            const goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;

            const milestone = goal.milestones.find(m => m.id === milestoneId);
            if (!milestone) return;

            milestone.completed = !milestone.completed;

            // Check if all milestones completed
            const allComplete = goal.milestones.length > 0 && goal.milestones.every(m => m.completed);
            goal.completedAt = allComplete ? Date.now() : null;

            localStorage.setItem('goalsV2', JSON.stringify(goals));
            renderGoals();
            updateDashboard();
            updateCharts();
        }

        function deleteMilestone(goalId, milestoneId) {
            if (!confirm('Delete this milestone?')) return;

            const goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;

            goal.milestones = goal.milestones.filter(m => m.id !== milestoneId);
            goal.completedAt = null;

            localStorage.setItem('goalsV2', JSON.stringify(goals));
            renderGoals();
            updateDashboard();
            updateCharts();
        }

        function deleteGoal(goalId) {
            if (!confirm('Delete this goal and all its milestones?')) return;

            let goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            goals = goals.filter(g => g.id !== goalId);
            localStorage.setItem('goalsV2', JSON.stringify(goals));

            // Also update legacy format
            const legacyGoals = goals.map(g => g.title);
            localStorage.setItem('goals', JSON.stringify(legacyGoals));

            renderGoals();
            updateDashboard();
            updateCharts();
        }

        // Limits Management
        function saveWeeklyLimit() {
            const limit = parseFloat(document.getElementById('weeklyLimit').value) || 0;
            const warning = parseFloat(document.getElementById('weeklyWarning').value) || 80;
            localStorage.setItem('weeklyLimit', limit);
            localStorage.setItem('weeklyWarning', warning);
            updateStats();
            renderMonths();
        }

        function saveMonthlyLimit() {
            const limit = parseFloat(document.getElementById('monthlyLimit').value) || 0;
            const warning = parseFloat(document.getElementById('monthlyWarning').value) || 80;
            localStorage.setItem('monthlyLimit', limit);
            localStorage.setItem('monthlyWarning', warning);
            updateStats();
            renderMonths();
            updateCharts();
        }

        function loadLimits() {
            const weeklyLimit = localStorage.getItem('weeklyLimit') || '';
            const weeklyWarning = localStorage.getItem('weeklyWarning') || '80';
            const monthlyLimit = localStorage.getItem('monthlyLimit') || '';
            const monthlyWarning = localStorage.getItem('monthlyWarning') || '80';

            document.getElementById('weeklyLimit').value = weeklyLimit;
            document.getElementById('weeklyWarning').value = weeklyWarning;
            document.getElementById('monthlyLimit').value = monthlyLimit;
            document.getElementById('monthlyWarning').value = monthlyWarning;
        }

        // Value Tracking
        function addWeeklyValue() {
            const weekNum = parseInt(document.getElementById('weekNum').value);
            const value = parseFloat(document.getElementById('weekValue').value);

            if (isNaN(weekNum) || isNaN(value) || weekNum < 1 || weekNum > 52) {
                alert('Please enter valid week (1-52) and value');
                return;
            }

            let weeklyData = JSON.parse(localStorage.getItem('weeklyValues')) || {};
            weeklyData[`week_${weekNum}`] = value;
            localStorage.setItem('weeklyValues', JSON.stringify(weeklyData));

            document.getElementById('weekNum').value = '';
            document.getElementById('weekValue').value = '';
            updateStats();
        }

        function addMonthlyValue() {
            const monthNum = parseInt(document.getElementById('monthNum').value);
            const value = parseFloat(document.getElementById('monthValue').value);

            if (isNaN(monthNum) || isNaN(value) || monthNum < 1 || monthNum > 12) {
                alert('Please enter valid month (1-12) and value');
                return;
            }

            let monthlyData = JSON.parse(localStorage.getItem('monthlyValues')) || {};
            monthlyData[`month_${monthNum}`] = value;
            localStorage.setItem('monthlyValues', JSON.stringify(monthlyData));

            document.getElementById('monthNum').value = '';
            document.getElementById('monthValue').value = '';
            updateStats();
            renderMonths();
            updateDashboard();
            updateCharts();
        }

        function loadValueData() {
            updateStats();
        }

        function getStatusClass(value, limit, warning) {
            if (!limit || limit === 0) return 'green';
            const percentage = (value / limit) * 100;
            if (percentage > 100) return 'red';
            if (percentage > warning) return 'yellow';
            return 'green';
        }

        function updateStats() {
            let weeklyData = JSON.parse(localStorage.getItem('weeklyValues')) || {};
            let monthlyData = JSON.parse(localStorage.getItem('monthlyValues')) || {};

            const weeklyTotal = Object.values(weeklyData).reduce((a, b) => a + b, 0);
            const monthlyTotal = Object.values(monthlyData).reduce((a, b) => a + b, 0);

            const weeklyLimit = parseFloat(localStorage.getItem('weeklyLimit')) || 0;
            const monthlyLimit = parseFloat(localStorage.getItem('monthlyLimit')) || 0;
            const weeklyWarning = parseFloat(localStorage.getItem('weeklyWarning')) || 80;
            const monthlyWarning = parseFloat(localStorage.getItem('monthlyWarning')) || 80;

            document.getElementById('weeklyTotal').textContent = weeklyTotal.toFixed(0);
            document.getElementById('monthlyTotal').textContent = monthlyTotal.toFixed(0);

            // Update status cards
            const weeklyStatus = getStatusClass(weeklyTotal, weeklyLimit, weeklyWarning);
            const monthlyStatus = getStatusClass(monthlyTotal, monthlyLimit, monthlyWarning);

            const weeklyCard = document.getElementById('weeklyCard');
            const monthlyCard = document.getElementById('monthlyCard');

            weeklyCard.className = `stat-card ${weeklyStatus}`;
            monthlyCard.className = `stat-card ${monthlyStatus}`;

            // Update limit text
            if (weeklyLimit > 0) {
                const weeklyPercent = ((weeklyTotal / weeklyLimit) * 100).toFixed(0);
                document.getElementById('weeklyLimitText').textContent = `Limit: $${weeklyLimit} (${weeklyPercent}%)`;
            } else {
                document.getElementById('weeklyLimitText').textContent = '';
            }

            if (monthlyLimit > 0) {
                const monthlyPercent = ((monthlyTotal / monthlyLimit) * 100).toFixed(0);
                document.getElementById('monthlyLimitText').textContent = `Limit: $${monthlyLimit} (${monthlyPercent}%)`;
            } else {
                document.getElementById('monthlyLimitText').textContent = '';
            }
        }

        function clearValueData() {
            localStorage.removeItem('weeklyValues');
            localStorage.removeItem('monthlyValues');
            document.getElementById('weekNum').value = '';
            document.getElementById('weekValue').value = '';
            document.getElementById('monthNum').value = '';
            document.getElementById('monthValue').value = '';
            updateStats();
            renderMonths();
            updateDashboard();
            updateCharts();
        }

        // Charts Functions
        function switchChartTab(tabName) {
            // Update tab active state
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update chart container visibility
            document.querySelectorAll('.chart-container').forEach(container => {
                container.classList.remove('active');
            });
            document.getElementById(`chart-${tabName}`).classList.add('active');
        }

        function initMonthlyTrendChart() {
            const ctx = document.getElementById('monthlyTrendChart');
            if (monthlyTrendChart) {
                monthlyTrendChart.destroy();
            }

            const datasets = [];
            const categoryColors = {
                monetary: { border: '#3b82f6', bg: 'rgba(59, 130, 246, 0.1)' },
                certifications: { border: '#a855f7', bg: 'rgba(168, 85, 247, 0.1)' },
                skills: { border: '#22c55e', bg: 'rgba(34, 197, 94, 0.1)' },
                memberships: { border: '#f97316', bg: 'rgba(249, 115, 22, 0.1)' }
            };

            categories.forEach(category => {
                const monthlyData = JSON.parse(localStorage.getItem(`monthlyValues-${category}`)) || {};
                const data = months.map((m, i) => monthlyData[`month_${i + 1}`] || 0);
                const hasData = data.some(v => v > 0);

                if (hasData) {
                    datasets.push({
                        label: categoryLabels[category].icon + ' ' + categoryLabels[category].name,
                        data: data,
                        borderColor: categoryColors[category].border,
                        backgroundColor: categoryColors[category].bg,
                        tension: 0.4,
                        fill: false,
                        pointBackgroundColor: categoryColors[category].border,
                        pointBorderColor: categoryColors[category].border,
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: categoryColors[category].border,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    });
                }
            });

            monthlyTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: months, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0', font: { size: 11 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(0);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        }
                    }
                }
            });
        }

        function initYearOverviewChart() {
            const ctx = document.getElementById('yearOverviewChart');
            if (yearOverviewChart) {
                yearOverviewChart.destroy();
            }

            const datasets = [];
            const categoryColors = {
                monetary: '#3b82f6',
                certifications: '#a855f7',
                skills: '#22c55e',
                memberships: '#f97316'
            };

            categories.forEach(category => {
                const monthlyData = JSON.parse(localStorage.getItem(`monthlyValues-${category}`)) || {};
                const data = months.map((m, i) => monthlyData[`month_${i + 1}`] || 0);
                const hasData = data.some(v => v > 0);

                if (hasData) {
                    datasets.push({
                        label: categoryLabels[category].icon + ' ' + categoryLabels[category].name,
                        data: data,
                        backgroundColor: categoryColors[category],
                        borderColor: categoryColors[category],
                        borderWidth: 1
                    });
                }
            });

            yearOverviewChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0', font: { size: 11 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(0);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        },
                        x: {
                            stacked: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        }
                    }
                }
            });
        }

        function initGoalsProgressChart() {
            const goals = JSON.parse(localStorage.getItem('goalsV2')) || [];
            let completedGoals = 0;
            let incompleteGoals = 0;

            goals.forEach(goal => {
                if (goal.milestones.length === 0) {
                    incompleteGoals++;
                } else {
                    const allComplete = goal.milestones.every(m => m.completed);
                    if (allComplete) {
                        completedGoals++;
                    } else {
                        incompleteGoals++;
                    }
                }
            });

            const ctx = document.getElementById('goalsProgressChart');
            if (goalsProgressChart) {
                goalsProgressChart.destroy();
            }

            goalsProgressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'In Progress'],
                    datasets: [{
                        data: [completedGoals, incompleteGoals],
                        backgroundColor: ['#22c55e', '#64748b'],
                        borderColor: ['#16a34a', '#475569'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#e2e8f0', font: { size: 12 }, padding: 20 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = completedGoals + incompleteGoals;
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(0) : 0;
                                    return context.label + ': ' + context.parsed + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if (typeof Chart !== 'undefined') {
                initMonthlyTrendChart();
                initYearOverviewChart();
                initGoalsProgressChart();
            }
        }

        // Months Grid
        function renderMonths() {
            const monthlyData = JSON.parse(localStorage.getItem('monthlyValues')) || {};
            const monthlyLimit = parseFloat(localStorage.getItem('monthlyLimit')) || 0;
            const monthlyWarning = parseFloat(localStorage.getItem('monthlyWarning')) || 80;
            const grid = document.getElementById('monthsGrid');
            grid.innerHTML = '';

            months.forEach((month, index) => {
                const monthNum = index + 1;
                const value = monthlyData[`month_${monthNum}`] || '';
                const status = value && monthlyLimit > 0 ? getStatusClass(value, monthlyLimit, monthlyWarning) : 'default';

                let statusText = '';
                if (monthlyLimit > 0 && value) {
                    const percent = ((value / monthlyLimit) * 100).toFixed(0);
                    if (percent > 100) {
                        statusText = `‚ö†Ô∏è EXCEEDED (${percent}%)`;
                    } else if (percent > monthlyWarning) {
                        statusText = `‚ö° WARNING (${percent}%)`;
                    } else {
                        statusText = `‚úì ON TRACK (${percent}%)`;
                    }
                }

                const card = document.createElement('div');
                card.className = `month-card ${status}`;
                card.innerHTML = `
                    <div class="month-name">${month}</div>
                    <div class="month-inputs">
                        <div class="month-input">
                            <label>Value ($)</label>
                            <input type="number" value="${value}" placeholder="0" 
                                onchange="updateMonthValue(${monthNum}, this.value)" />
                        </div>
                    </div>
                    ${statusText ? `<div class="month-status ${status}">${statusText}</div>` : ''}
                `;
                grid.appendChild(card);
            });
        }

        function updateMonthValue(monthNum, value) {
            let monthlyData = JSON.parse(localStorage.getItem('monthlyValues')) || {};
            if (value) {
                monthlyData[`month_${monthNum}`] = parseFloat(value);
            } else {
                delete monthlyData[`month_${monthNum}`];
            }
            localStorage.setItem('monthlyValues', JSON.stringify(monthlyData));
            updateStats();
            renderMonths();
            updateDashboard();
            updateCharts();
        }

        // Clear all data
        function clearAllData() {
            localStorage.clear();
            location.reload();
        }

        // Initialize on load
        initPlanner();
    </script>
</body>
</html>